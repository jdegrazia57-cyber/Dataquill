<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dataquill — Turn Your Data Into Decisions</title>
  <meta name="description" content="Dataquill: AI powered embedded analytics platform. Upload a CSV and explore widgets in a clean black-and-teal UI." />

  <!-- Social (update og:url after you confirm your domain) -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Dataquill — Turn Your Data Into Decisions" />
  <meta property="og:description" content="Upload a CSV to get instant KPIs, a table view, and quick charts. Export, white-label, and ship." />
  <meta property="og:url" content="/" />
  <meta property="og:image" content="/og.png" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- Libraries (client-side only) -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <style>
    :root{
      --bg:#000814;
      --panel:#0b1428;
      --card:#0f1c22;
      --ink:#eaffff;
      --sub:#86e3d1;
      --muted:#7aa2a9;
      --teal:#23dbc1;
      --teal-2:#11b7a1;
      --border:#1b2a3a;
      --glow:0 8px 40px rgba(35,219,193,0.12);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:radial-gradient(1200px 600px at 50% -200px,#06252a 0%,transparent 50%),var(--bg);
      color:var(--ink);font:16px/1.45 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    }
    a{color:#8ae6ff;text-decoration:none}
    .wrap{max-width:1100px;margin:0 auto;padding:20px}
    .topbar{position:sticky;top:0;z-index:10;background:linear-gradient(#051219,#051219cc);backdrop-filter:blur(6px);border-bottom:1px solid var(--border)}
    .topbar .inner{display:flex;align-items:center;gap:14px;padding:12px 20px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.3px}
    .dot{width:18px;height:18px;border-radius:5px;background:linear-gradient(180deg,#23dbc1,#11b7a1);box-shadow:0 0 20px #23dbc199}
    .spacer{flex:1}
    .pill{background:#081524;border:1px solid var(--border);border-radius:999px;padding:8px 12px;color:var(--ink);opacity:.9}
    .pill:hover{border-color:#244056;opacity:1}
    .grid{display:grid;gap:16px}
    .grid.two{grid-template-columns:1fr 1fr}
    .card{
      background:linear-gradient(180deg,rgba(52,164,175,.08),transparent 50%),var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--glow);
      padding:18px;
    }
    .title{font-size:22px;font-weight:800;margin:0 0 8px}
    .muted{color:var(--muted)}
    .section-title{font-size:20px;font-weight:800;margin:0 0 10px}
    .drag{
      border:2px dashed #2c8f97;border-radius:12px;padding:22px;text-align:center;color:#bfeef0;background:rgba(30,73,82,.2)
    }
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .btn{
      background:linear-gradient(180deg,var(--teal),var(--teal-2));
      border:none;color:#002522;font-weight:800;letter-spacing:.2px;
      padding:10px 14px;border-radius:12px;box-shadow:0 6px 26px rgba(35,219,193,.25);cursor:pointer
    }
    .btn.secondary{background:#0b1b2a;color:var(--ink);border:1px solid var(--border);box-shadow:none}
    .btn.ghost{background:transparent;color:var(--ink);border:1px dashed #2c8f97}
    .stat{background:#0a1624;border:1px solid var(--border);border-radius:12px;padding:14px;min-width:140px}
    .stat .k{font-size:22px;font-weight:900}
    .controls{display:grid;grid-template-columns:repeat(4, minmax(160px,1fr));gap:10px}
    select, input[type="text"]{
      width:100%;background:#081524;border:1px solid var(--border);color:var(--ink);
      padding:10px;border-radius:10px;outline:none
    }
    table{width:100%;border-collapse:collapse;font-size:14px}
    th,td{border-bottom:1px solid #0e2b34;padding:10px;text-align:left}
    .footer{margin:60px 0 20px;text-align:center;color:var(--muted)}
    @media (max-width:900px){
      .grid.two{grid-template-columns:1fr}
      .controls{grid-template-columns:1fr 1fr}
    }
  </style>
</head>
<body>
  <!-- TOP -->
  <div class="topbar">
    <div class="inner wrap">
      <div class="brand">
        <div class="dot" id="brandDot"></div>
        <span id="brandName">Dataquill</span>
      </div>
      <div class="spacer"></div>
      <a class="pill" href="#pricing">Pricing</a>
      <a class="pill" href="#faq">FAQ</a>
      <a class="pill" href="#app">Live App</a>
    </div>
  </div>

  <main class="wrap" id="app">
    <!-- HERO -->
    <div class="grid two">
      <div class="card">
        <h2 class="title">AI powered embedded analytics platform</h2>
        <p class="muted">Upload a CSV to get instant KPIs, a table view, and a quick chart. Export, white-label, and ship.</p>
      </div>
      <div class="card">
        <h2 class="title">Quick charts</h2>
        <p class="muted">The first numeric column is charted automatically. Switch chart types and filters instantly.</p>
      </div>
    </div>

    <!-- UPLOAD + CONTROLS -->
    <div class="card" style="margin-top:16px">
      <h3 class="section-title">Drop or choose a CSV</h3>
      <div id="drop" class="drag">Drag a .csv here or <label for="file" style="text-decoration:underline;cursor:pointer">browse</label></div>
      <input id="file" type="file" accept=".csv" hidden />
      <div class="row" style="margin-top:12px">
        <button class="btn" id="btnSample">Load Sample</button>
        <button class="btn secondary" id="btnClear">Clear Data</button>
        <button class="btn" id="btnPng">Export PNG (chart)</button>
        <button class="btn secondary" id="btnPdf">Export PDF</button>
        <button class="btn ghost" id="btnSave">Save Dashboard</button>
        <button class="btn ghost" id="btnLoad">Load Saved</button>
      </div>

      <div class="row" style="margin-top:12px">
        <div class="stat"><div class="muted">Rows</div><div class="k" id="rowsK">0</div></div>
        <div class="stat"><div class="muted">Columns</div><div class="k" id="colsK">0</div></div>
        <div class="stat"><div class="muted">Sample</div><div class="k" id="sampleK">—</div></div>
      </div>

      <div class="controls" style="margin-top:14px">
        <div>
          <label class="muted">Chart type</label>
          <select id="chartType">
            <option value="bar">Bar</option>
            <option value="line">Line</option>
            <option value="area">Area</option>
            <option value="scatter">Scatter</option>
            <option value="pie">Pie</option>
          </select>
        </div>
        <div>
          <label class="muted">X / Category</label>
          <select id="xCol"></select>
        </div>
        <div>
          <label class="muted">Y (numeric)</label>
          <select id="yCol"></select>
        </div>
        <div>
          <label class="muted">Filter (column)</label>
          <select id="fCol"></select>
        </div>
        <div>
          <label class="muted">Filter value</label>
          <select id="fVal"></select>
        </div>
        <div>
          <label class="muted">White-label: Product name</label>
          <input id="brandInput" type="text" placeholder="Dataquill" />
        </div>
        <div>
          <label class="muted">White-label: Logo URL (png/svg)</label>
          <input id="logoInput" type="text" placeholder="https://…" />
        </div>
        <div class="row" style="align-items:flex-end">
          <button class="btn secondary" id="applyBrand">Apply Branding</button>
        </div>
      </div>
    </div>

    <!-- VISUALS -->
    <div class="grid two" style="margin-top:16px">
      <div class="card">
        <h3 class="section-title">Auto chart</h3>
        <canvas id="chart" height="220"></canvas>
      </div>
      <div class="card">
        <h3 class="section-title">Table</h3>
        <div style="overflow:auto;max-height:420px">
          <table id="table"><thead></thead><tbody></tbody></table>
        </div>
      </div>
    </div>

    <!-- PRICING + FAQ -->
    <div class="grid two" style="margin-top:16px" id="pricing">
      <div class="card">
        <h3 class="section-title">Pricing</h3>
        <p><strong>Free:</strong> Upload CSV and preview widgets instantly.</p>
        <p><strong>Pro (TBD):</strong> Export dashboards, white-label branding, priority support.</p>
      </div>
      <div class="card" id="faq">
        <h3 class="section-title">FAQ</h3>
        <p><strong>Is my data sent to a server?</strong><br/>No. All processing happens in your browser.</p>
        <p><strong>What file formats are supported?</strong><br/>CSV for now. XLSX coming soon.</p>
      </div>
    </div>

    <div class="footer">© 2025 <span id="footBrand">Dataquill</span>. All rights reserved.</div>
  </main>

  <script>
    // ---------- Helpers ----------
    const $ = (q)=>document.querySelector(q);
    const brandNameEl = $('#brandName'), brandDot = $('#brandDot'), footBrand = $('#footBrand');

    // State
    let rows = [];
    let cols = [];
    let chart;
    let numericCols = [];

    // Elements
    const file = $('#file'), drop = $('#drop');
    const rowsK = $('#rowsK'), colsK = $('#colsK'), sampleK = $('#sampleK');
    const xCol = $('#xCol'), yCol = $('#yCol'), fCol = $('#fCol'), fVal = $('#fVal');
    const chartType = $('#chartType');

    // Branding (localStorage)
    const brandInput = $('#brandInput'), logoInput = $('#logoInput'), applyBrand = $('#applyBrand');
    const savedBrand = JSON.parse(localStorage.getItem('dq.brand') || '{}');
    if(savedBrand.name){ brandNameEl.textContent = savedBrand.name; footBrand.textContent = savedBrand.name; brandInput.value=savedBrand.name; }
    if(savedBrand.logo){ brandDot.style.background = `center/cover no-repeat url(${savedBrand.logo})`; logoInput.value=savedBrand.logo; }

    applyBrand.onclick = ()=>{
      const name = brandInput.value.trim() || 'Dataquill';
      const logo = logoInput.value.trim();
      brandNameEl.textContent = name;
      footBrand.textContent = name;
      if(logo){
        brandDot.style.background = `center/cover no-repeat url(${logo})`;
      }else{
        brandDot.style.background = 'linear-gradient(180deg,#23dbc1,#11b7a1)';
      }
      localStorage.setItem('dq.brand', JSON.stringify({name, logo}));
    };

    // ---------- CSV load ----------
    function parseCSV(text){
      const parsed = Papa.parse(text.trim(), {header:true, dynamicTyping:true, skipEmptyLines:true});
      rows = parsed.data;
      cols = parsed.meta.fields || [];
      numericCols = cols.filter(c => rows.some(r => typeof r[c] === 'number'));
      rowsK.textContent = rows.length;
      colsK.textContent = cols.length;
      sampleK.textContent = rows[0] ? (rows[0][cols[0]] ?? '—') : '—';
      populateControls();
      renderTable(rows);
      drawChart();
    }

    function populateControls(){
      const fill = (sel, arr)=>{ sel.innerHTML=''; arr.forEach(c=>sel.append(new Option(c,c))); };
      fill(xCol, cols);
      fill(yCol, numericCols.length?numericCols:cols);
      fill(fCol, ['(none)', ...cols]);
      fVal.innerHTML = '';
    }

    function renderTable(data){
      const thead = $('#table thead'), tbody = $('#table tbody');
      thead.innerHTML = '';
      tbody.innerHTML = '';
      if(!data.length){ return; }
      thead.innerHTML = '<tr>'+cols.map(c=>`<th>${escapeHtml(c)}</th>`).join('')+'</tr>';
      const frag = document.createDocumentFragment();
      data.forEach(r=>{
        const tr = document.createElement('tr');
        tr.innerHTML = cols.map(c=>`<td>${escapeHtml(r[c])}</td>`).join('');
        frag.appendChild(tr);
      });
      tbody.appendChild(frag);
    }

    function escapeHtml(v){
      if(v===undefined || v===null) return '';
      return String(v).replace(/[&<>"']/g, s=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[s]));
    }

    // ---------- Chart ----------
    function getFiltered(){
      const fc = fCol.value;
      if(!rows.length) return [];
      if(!fc || fc==='(none)') return rows;
      const val = fVal.value;
      return rows.filter(r => String(r[fc]) === val);
    }

    function drawChart(){
      const data = getFiltered();
      if(!data.length || !cols.length) { paintChart([],[], 'bar'); return; }

      const type = chartType.value;
      const x = xCol.value || cols[0];
      const y = yCol.value || (numericCols[0] || cols[0]);

      if(type==='pie'){
        // Aggregate by category counts or sum of numeric if chosen
        const m = new Map();
        data.forEach(r=>{
          const key = String(r[x]);
          const val = (typeof r[y]==='number') ? r[y] : 1;
          m.set(key, (m.get(key)||0) + val);
        });
        const labels = [...m.keys()];
        const values = [...m.values()];
        paintChart(labels, values, 'pie', {label:y});
      }else if(type==='scatter'){
        const points = data.map(r=>({x: Number(r[x]), y: Number(r[y])})).filter(p=>!Number.isNaN(p.x)&&!Number.isNaN(p.y));
        paintScatter(points, `${x} vs ${y}`);
      }else{
        const labels = data.map(r=>String(r[x]));
        const values = data.map(r=>Number(r[y]));
        const mode = (type==='area')?'line':type;
        paintChart(labels, values, mode, {fill: type==='area', label:y});
      }
    }

    function paintChart(labels, values, type, opts={}){
      const ctx = document.getElementById('chart');
      if(chart) chart.destroy();
      chart = new Chart(ctx, {
        type,
        data: {
          labels,
          datasets: [{
            label: opts.label || 'Series',
            data: values,
            borderWidth: 2,
            tension: 0.25,
            fill: !!opts.fill
          }]
        },
        options: {
          responsive:true,
          plugins: {
            legend: {labels:{color:'#bfeef0'}},
            tooltip: {backgroundColor:'#0b1b2a'}
          },
          scales: (type==='pie')?{}:{
            x: { ticks:{color:'#89bac6'}, grid:{color:'#0e2b34'} },
            y: { ticks:{color:'#89bac6'}, grid:{color:'#0e2b34'} }
          }
        }
      });
    }

    function paintScatter(points, label){
      const ctx = document.getElementById('chart');
      if(chart) chart.destroy();
      chart = new Chart(ctx, {
        type:'scatter',
        data: {
          datasets: [{
            label, data: points, borderWidth: 0, pointRadius: 4
          }]
        },
        options: {
          responsive:true,
          plugins:{ legend:{labels:{color:'#bfeef0'}}, tooltip:{backgroundColor:'#0b1b2a'} },
          scales:{
            x:{ticks:{color:'#89bac6'}, grid:{color:'#0e2b34'}},
            y:{ticks:{color:'#89bac6'}, grid:{color:'#0e2b34'}}
          }
        }
      });
    }

    // ---------- Events ----------
    file.onchange = (e)=>{ const f=e.target.files[0]; if(!f) return; f.text().then(parseCSV); };
    drop.addEventListener('dragover', e=>{ e.preventDefault(); drop.style.opacity=.9; });
    drop.addEventListener('dragleave', ()=>{ drop.style.opacity=1; });
    drop.addEventListener('drop', e=>{
      e.preventDefault(); drop.style.opacity=1;
      const f = e.dataTransfer.files?.[0]; if(!f) return;
      f.text().then(parseCSV);
    });

    document.getElementById('btnSample').onclick = ()=>{
      const csv = `Name,City,Sales
Alice,New York,120
Bob,Miami,95
Cara,Chicago,141
Dan,LA,110
Eve,NYC,99`;
      parseCSV(csv);
    };

    document.getElementById('btnClear').onclick = ()=>{
      rows=[]; cols=[]; numericCols=[]; rowsK.textContent='0'; colsK.textContent='0'; sampleK.textContent='—';
      $('#table thead').innerHTML=''; $('#table tbody').innerHTML='';
      if(chart) chart.destroy();
    };

    chartType.onchange = drawChart;
    xCol.onchange = drawChart;
    yCol.onchange = drawChart;

    fCol.onchange = ()=>{
      const fc = fCol.value;
      fVal.innerHTML = '';
      if(!rows.length || !fc || fc==='(none)') return;
      const uniq = [...new Set(rows.map(r=>String(r[fc])))].sort();
      uniq.forEach(v=>fVal.append(new Option(v,v)));
      drawChart();
    };
    fVal.onchange = drawChart;

    // Save/Load dashboard (localStorage)
    document.getElementById('btnSave').onclick = ()=>{
      const state = {
        rows, cols,
        chartType: chartType.value,
        x: xCol.value, y: yCol.value,
        fCol: fCol.value, fVal: fVal.value
      };
      localStorage.setItem('dq.state', JSON.stringify(state));
      alert('Dashboard saved locally ✅');
    };
    document.getElementById('btnLoad').onclick = ()=>{
      const s = localStorage.getItem('dq.state');
      if(!s){ alert('No saved dashboard found'); return; }
      const state = JSON.parse(s);
      rows = state.rows || []; cols = state.cols || [];
      numericCols = cols.filter(c => rows.some(r => typeof r[c] === 'number'));
      rowsK.textContent = rows.length; colsK.textContent=cols.length; sampleK.textContent = rows[0] ? (rows[0][cols[0]] ?? '—') : '—';
      populateControls();
      chartType.value = state.chartType || 'bar';
      xCol.value = state.x || cols[0]; yCol.value = state.y || (numericCols[0]||cols[0]);
      fCol.value = state.fCol || '(none)';
      // Rebuild filter values
      fCol.dispatchEvent(new Event('change'));
      if(state.fVal) fVal.value = state.fVal;
      renderTable(rows);
      drawChart();
    };

    // Export PNG
    document.getElementById('btnPng').onclick = ()=>{
      if(!chart){ alert('Nothing to export yet'); return; }
      const link = document.createElement('a');
      link.download = 'dataquill-chart.png';
      link.href = chart.toBase64Image('image/png', 1.0);
      link.click();
    };

    // Export PDF
    document.getElementById('btnPdf').onclick = async ()=>{
      if(!chart){ alert('Nothing to export yet'); return; }
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({orientation:'landscape', unit:'pt', format:'a4'});
      pdf.setFont('helvetica','bold'); pdf.setFontSize(18);
      pdf.text('Dataquill — Chart Export', 40, 40);
      const img = chart.toBase64Image('image/png', 1.0);
      pdf.addImage(img, 'PNG', 40, 70, 760, 420);
      pdf.setFont('helvetica','normal'); pdf.setFontSize(11);
      pdf.text(`Rows: ${rows.length} | Columns: ${cols.length} | Type: ${chartType.value}`, 40, 520);
      pdf.save('dataquill-chart.pdf');
    };

    // Initialize empty selectors
    populateControls();
  </script>
</body>
</html>
